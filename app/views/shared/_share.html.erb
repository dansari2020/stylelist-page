<div x-data="{ socialMenu : false }">
  <button  @click="socialMenu = true" @click.away="socialMenu = false" class="flex items-center justify-center px-2 py-2 ml-auto text-sm text-right text-black bg-transparent rounded-md md:px-4 md:font-bold md:text-md max-w-max whitespace-nowrap hover:bg-yellow-500 hover:shadow-lg bg-yellow-light max-h-max">
    <%= image_tag "icons/share.svg", class: "w-4 mr-2" %>
    Share
  </button>
  <div x-show="socialMenu" class="w-44 p-4 absolute right-0 z-20 py-1 mt-2 origin-top-right bg-white rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 group-hover:block focus:outline-none <%= defined?(classMenu) && classMenu %>" role="menu" aria-orientation="vertical" aria-labelledby="user-menu-button" tabindex="-1">
    <p class="text-xs font-medium text-gray-500 md:text-sm leading-2">
      <ul class="flex flex-wrap flex-col">
        <% %w[copy_link facebook twitter].each do |social| %>
          <li class="mt-2">
            <%= link_to "#", class: "flex flex-row items-center", data: { link: defined?(resource) && resource }, 
            "@click.prevent": "shareBtn(\"#{social}\",\"#{defined?(share_title) && share_title}\", 
            \"https://developers.facebook.com/docs/workplace/sharing/share-dialog/\",
            \"#{defined?(share_desc) && share_desc.html_safe}\",
            \"#{defined?(share_image) && share_image}\")" do %>
              <div class="w-1/4">
                <%= image_tag "icons/#{social}.svg", class: "h-5 pr-3" %>
              </div>
              <span class="font-light text-base w-3/4 text-left"><%= social.humanize %></span>
            <% end %>
          </li>
        <% end %>
      </ul>
    </p>
  </div>
</div>
<script language="javascript">
  function shareBtn(shareType, title = '', url = '', summary = '', image = '') {
    if (title === '' || !title) {
      title = window.shareTitle
    }
    if (url === '' || !url) {
      url = window.shareLink
    }
    if (summary === '' || !summary) {
      summary = window.shareDesc
    }
    if (image === '' || !image) {
      image = window.shareImage
    }
    switch (shareType) {
      case "facebook":
        fbshareCurrentPage(url, title, summary, image)
        break;
      case "twitter":
        tweetCurrentPage(url, title, image)
        break;
  
      default:
        copyToClipboard(url);
        break;
    }
  }
  
  function copyToClipboard(text) {
    var dummy = document.createElement("textarea");
    document.body.appendChild(dummy);
    dummy.value = text;
    dummy.select();
    document.execCommand("copy");
    document.body.removeChild(dummy);
  }
  
  function shareFacebook(title, url, summary, image) {
    var title = encodeURI(title);
    var url = encodeURI(url);
    var summary = encodeURI(summary);
    var image = encodeURI(image);
    FB.ui({
      method: 'send',
      link: url
    });
  }
  function fbshareCurrentPage(url, title = '', summary = '', image = '') {
    params = '?s=100'+
      '&p[title]=' + title +
      '&p[summary]=' + summary +
      '&p[url]=' + encodeURIComponent(url) +
      '&p[images][0]=' + encodeURIComponent(image)
      window.open("https://www.facebook.com/sharer/sharer.php"+params, '', 
        'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');
    return false; 
  }

  function tweetCurrentPage(url, title, image){ 
    window.open("https://twitter.com/share?card=photo&image="+ encodeURIComponent(image)+"&url="+ encodeURIComponent(url)+"&text="+ title, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');
    return false;
  }
</script>