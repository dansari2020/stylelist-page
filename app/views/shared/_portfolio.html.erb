<style>
  input + label.ediable {
    position: relative;
  }
  input[type="checkbox"] + label.ediable span {
    background: url('<%= image_url("icons/unselected-checkbox.svg") %>') top left no-repeat;
    display: inline-block;
    vertical-align: middle;
    width: 45px;
    height: 45px;
    position: absolute;
    top:10px;
    left:10px;
    z-index: 10;
  }
  input[type="checkbox"]:checked + label.ediable span {
    background: url('<%= image_url("icons/selected-checkbox.svg") %>') top left no-repeat;
  }
</style>
<% if current_user.portfolios.published.empty? %>
  <div class="flex items-center flex-1">
    <div class="py-12 mx-auto mb-14 md:mb-0">
      <p class="mb-4 text-sm text-center text-gray-500">
        Your portfolio is empty
      </p>
      <% portfolio = current_user.portfolios.new %>
      <% form_id = dom_id(portfolio, "pictures") %>
      <%= form_for(portfolio, url: portfolios_path, html: { method: :post, id: form_id }) do |f| %>
        <%= f.label :pictures do %>
          <span class="px-4 py-2 text-indigo-500 bg-white border border-indigo-500 rounded-md hover:text-white hover:bg-indigo-500">Upload Your First Photo</span>
          <%= f.file_field :pictures, accept: "image/*", class: "hidden", onchange: "document.getElementById('#{form_id}').submit()" %>
          <%= f.submit "Submit", class: "hidden" %>
        <% end %>
      <% end %>
    </div>
  </div>
<% else %>
  <div x-data="{ imgModal : false, imgModalSrc : '', hairLength: '', imgModalDesc : [], imgModalServiceTypes: [],  imgModalHairTypes: [], editUrl: '#', deleteUrl: '#', popupLeft: '', popupRight: '', linkable: ''}">
    <template @img-modal.window="imgModal = true; imgModalSrc = $event.detail.imgModalSrc; imgModalDesc = $event.detail.imgModalDesc; imgModalServiceTypes = $event.detail.imgModalServiceTypes; imgModalHairTypes = $event.detail.imgModalHairTypes;  editUrl = $event.detail.editUrl;  deleteUrl = $event.detail.deleteUrl; hairLength = $event.detail.hairLength; popupLeft = $event.detail.popupLeft; popupRight = $event.detail.popupRight;" x-if="imgModal">
      <div class="fixed inset-0 z-50 flex items-center justify-center w-full p-2 overflow-hidden popup h-100" style="backdrop-filter: blur(21px);background: rgba(0, 0, 0, 0.4);">
        <div id="portfolioModal" @click.away="linkable !== '' ? linkable = '' : imgModal = ''; linkable = '';" class="max-h-full overflow-auto">
          
        </div>
      </div>
    </template>
  </div>
  <% link_ids = [] %>
  <%= form_for(:portfolio_pictures, url: destroy_pictures_portfolios_path, html: {method: :delete, id: id}) do |f| %>
    <div class="grid grid-cols-2 gap-px mb-20 md:gap-1.5 md:grid-cols-3 lg:grid-cols-4">
      <% current_user.portfolios.published.with_attached_pictures.order(created_at: :desc).each do |portfolio| %>
        <% portfolio.pictures.each do |p| %>
          <%= check_box_tag "pictures_ids[]", p.id, false, id: dom_id(p), class: "hidden", ":disabled": "!manage" %>
          <label for="<%= dom_id(p) %>" :class="{ 'ediable' : manage}">
            <span></span>
            <% link_ids << dom_id(portfolio) %>
            <%= link_to portfolio_path(portfolio), remote: true, "id": "#{link_ids[-1]}", "@click": "dispatchFunction($dispatch, manage, '#{link_ids[-1]}')", class: "cursor-pointer popup-target" do %>
                <%= image_tag thumb_url(p), class: "md:rounded object-contain mx-auto border", style: "border-color: #e0e0e0" ,":class": "{ 'filter brightness-50 grayscale contrast-200' : manage }" %>
            <% end %>
          </label>
        <% end %>
      <% end %>
    </div>
  <% end %>
<% end %>
<script>
  var popupTargets = document.querySelectorAll('.popup-target')
  var links = [];
  for (var i = 0, len = popupTargets.length ; i < len; i++) {
      links.push(popupTargets[i].id);
  }
  function dispatchFunction($dispatch, manage, linkId, imgModalSrc, imgModalDesc, imgModalServiceTypes, imgModalHairTypes, hairLength, editUrl, deleteUrl, shareLink) {
    if (manage) {
      return false;
    } else {
      const w = window.innerWidth;
      if (w <= 767) {
        window.location = deleteUrl
      } else {
        const currentIndex = links.indexOf(linkId);
        if (currentIndex !== -1 && currentIndex - 1 >= 0 ) {
          popupLeft = links[currentIndex - 1]
        } else {
          popupLeft = ''
        }
        if (currentIndex !== -1 && currentIndex + 1 < links.length ) {
          popupRight = links[currentIndex + 1]
        } else {
          popupRight = ''
        }
        window.shareLink = shareLink
        window.shareTitle = "Portfolio StylistPage"
        window.shareDesc = imgModalDesc
        window.shareImage = imgModalSrc
  
        $dispatch('img-modal', {
        imgModalSrc: imgModalSrc,
        imgModalDesc: imgModalDesc,
        imgModalServiceTypes: imgModalServiceTypes,
        imgModalHairTypes: imgModalHairTypes,
        hairLength: hairLength,
        editUrl: editUrl,
        deleteUrl: deleteUrl,
        popupLeft: popupLeft,
        popupRight: popupRight,
        })
      }
    }
  }
</script>
